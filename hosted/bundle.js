(()=>{var e={867:(e,n,t)=>{const{clientHeaders:a}=t(17),{boardHeight:o,boardWidth:r,endLine:i,moveLine:s,startLine:c}=t(548);let d,l,m,u,g=!1;const w=(e,{x:n,y:t})=>{const a=new ArrayBuffer(17),o=new DataView(a);o.setUint8(0,e),o.setFloat64(1,n),o.setFloat64(9,t),u.send(a)},f=e=>{const n={};let t,a;switch(e.type){case"touchdown":case"touchmove":t=e.touches[0].pageX,a=e.touches[0].pageY;break;default:t=e.pageX,a=e.pageY}return n.x=(t-l.offsetLeft)*(r/l.offsetWidth),n.y=(a-l.offsetTop)*(o/l.offsetHeight),n},b=e=>{if(g)return;g=!0;const n=f(e);c(m,n),w(a.penDown,n)},p=e=>{if(!g)return;const n=f(e);s(m,n),w(a.penMove,n)},h=()=>{g&&(g=!1,i(m),u.send(new Uint8Array([a.penUp]).buffer))};e.exports={init:()=>(d=document.querySelector("#drawingBoard"),l=document.querySelector("#drawingBoardOuter"),!!(d.getContext&&d.getContext("2d")&&d.toDataURL&&d.toDataURL())&&(m=d.getContext("2d"),l.onmousedown=b,l.onmousemove=p,l.onmouseup=h,l.onmouseout=h,l.ontouchstart=b,l.ontouchend=h,l.ontouchmove=p,l.ontouchcancel=h,m.lineWidth=3,m.strokeStyle="black",m.lineCap="round",m.lineJoin="round",!0)),toDataURL:()=>d.toDataURL(),drawImageData:e=>{m.putImageData(new ImageData(new Uint8ClampedArray(e),r,o),0,0)},submitDrawing:()=>{u.send(new Uint8Array([a.submitDrawing,...m.getImageData(0,0,r,o).data]).buffer)},clear:()=>{const e=m.fillStyle;m.fillStyle="white",m.fillRect(0,0,r,o),m.fillStyle=e},setSocket:e=>{u=e}}},548:e=>{const n=(e,{x:n,y:t})=>{e.lineTo(n,t),e.stroke()};e.exports={boardHeight:480,boardWidth:640,endLine:e=>{e.closePath()},moveLine:n,startLine:(e,{x:t,y:a})=>{e.beginPath(),e.moveTo(t,a),n(e,{x:t,y:a})}}},136:e=>{const n="ABCDEFGHIJKLMNOPQRSTUVWXYZ";e.exports={makeNewCode:e=>{let t;do{t="";for(let e=0;e<3;e++)t+=n[Math.floor(26*Math.random())]}while(e&&e[t]);return t},validateCode:(e,t,a)=>{if(!e)return"No game code specified.";const o=e.length;for(let t=0;t<o;t++){const a=e[t];if(!n.includes(a))return"Invalid game code character(s)."}if(3!==o)return"Invalid game code length.";if(t){if(!t[e])return`No game with code ${e} has been created.`;if(a&&0!==t[e].state)return`The game with code ${e} is already in progress.`}return null}}},17:e=>{e.exports={clientHeaders:{newGame:0,joinGame:1,submitDrawing:2,penDown:3,penMove:4,penUp:5,updateReady:6},serverHeaders:{errorMsg:0,newGameCreated:1,gameStarting:2,scribbleDone:3,expensionDone:4}}}},n={};function t(a){var o=n[a];if(void 0!==o)return o.exports;var r=n[a]={exports:{}};return e[a](r,r.exports,t),r.exports}(()=>{const e=t(136),n=t(867),{clientHeaders:a,serverHeaders:o}=t(17),r=`ws://${window.location.hostname}:443`;let i,s,c={},d={};const l=e=>{const n=new Uint8Array(e),t=n[0],a=n.slice(1),r={header:t};switch(t){case o.errorMsg:case o.newGameCreated:r.string=String.fromCharCode(...a);break;case o.gameStarting:[r.round,r.whoScribbles]=a;break;case o.scribbleDone:case o.expensionDone:r.imageDataBuffer=a}return r},m=(e,n)=>{const t=n||(e=>e),a={};for(let n=0;n<e.length;n++){const o=e[n];a[o]=document.querySelector(`#${t(o)}`)}return a},u=e=>{c[e]&&Object.keys(c).forEach((n=>{c[n].classList.toggle("activeScreen",n===e)}))},g=(e,t,r,c,m)=>{const w=()=>{d.finalScribble.src=i,d.finalExpension.src=s,d.saveDrawingsButton.onclick=()=>{(e=>{const n=t=>{if(t>=e.length)return;const a=e[t],o=document.createElement("a");o.href=a.url,o.target="_parent","download"in o&&(o.download=a.filename),(document.body||document.documentElement).appendChild(o),o.click(),o.remove(),setTimeout((()=>n(t+1)),500)};n(0)})([{url:i,filename:`expensiongame_${e}_round${r+1}_1`},{url:s,filename:`expensiongame_${e}_round${r+1}_2`}])},u("done");const n=a=>{const r=l(a.data);r.header===o.gameStarting&&(t.removeEventListener("message",n),g(e,t,r.round,r.whoScribbles,m))};t.addEventListener("message",n)};if(d.finalScribble.classList.remove("finalDrawingActive"),d.finalExpension.classList.add("finalDrawingActive"),d.finalScribbleOrExpension.checked=!0,d.playAgainCheckbox.checked=!1,i=void 0,s=void 0,d.whyAmIWaiting.innerHTML="Waiting for the other player to make a scribble...",d.whatAmIDrawing.innerHTML="Make a scribble!",n.clear(),d.playAgainCheckbox.onclick=e=>{t.send(new Uint8Array([a.updateReady,e.target.checked?1:0]).buffer)},c===m)u("drawing"),d.submitDrawingButton.onclick=()=>{i=n.toDataURL(),n.submitDrawing(),d.whyAmIWaiting.innerHTML="Waiting for the other player to make an exPENsion of your scribble...",u("waiting");const e=a=>{const r=l(a.data);r.header===o.expensionDone&&(t.removeEventListener("message",e),n.drawImageData(r.imageDataBuffer),s=n.toDataURL(),w())};t.addEventListener("message",e)};else{u("waiting");const e=a=>{const r=l(a.data);r.header===o.scribbleDone&&(t.removeEventListener("message",e),n.drawImageData(r.imageDataBuffer),i=n.toDataURL(),d.submitDrawingButton.onclick=()=>{s=n.toDataURL(),n.submitDrawing(),w()},d.whatAmIDrawing.innerHTML="It's exPENsion time! Turn this scribble into a coherent drawing!",u("drawing"))};t.addEventListener("message",e)}};window.onload=()=>{c=m(["start","displayCode","inputCode","waiting","drawing","done","noCanvas"],(e=>`${e}Screen`)),d=m(["newGameButton","newGameError","joinGameButton","codeDisplay","codeInput","submitJoinCodeButton","joinError","whyAmIWaiting","whatAmIDrawing","submitDrawingButton","finalScribble","finalExpension","finalScribbleOrExpension","saveDrawingsButton","playAgainCheckbox"]),n.init()||u("noCanvas");const t=e=>{d.newGameButton.disabled=e,d.joinGameButton.disabled=e,d.submitJoinCodeButton.disabled=e,d.codeInput.disabled=e},i=()=>{t(!1),u("start"),d.newGameError.innerHTML="Connection lost."};d.newGameButton.onclick=()=>{d.newGameError.innerHTML="",t(!0);const e=new WebSocket(r);e.binaryType="arraybuffer",e.addEventListener("open",(()=>{e.send(new Uint8Array([a.newGame]).buffer)})),e.addEventListener("close",i),n.setSocket(e);const s=n=>{const a=l(n.data),{header:r}=a;if(e.removeEventListener("message",s),r===o.errorMsg)t(!1),d.newGameError.innerHTML=a.string,e.removeEventListener("close",i),e.close();else if(r===o.newGameCreated){const n=a.string;d.codeDisplay.innerHTML=n,u("displayCode");const t=a=>{const o=l(a.data);e.removeEventListener("message",t),g(n,e,o.round,o.whoScribbles,0)};e.addEventListener("message",t)}};e.addEventListener("message",s)},d.joinGameButton.onclick=()=>u("inputCode");const s=()=>{d.joinError.innerHTML="",t(!0);const s=d.codeInput.value.toUpperCase(),c=e.validateCode(s);if(c)t(!1),d.joinError.innerHTML=c.message;else{const e=new WebSocket(r);e.binaryType="arraybuffer",e.addEventListener("open",(()=>{e.send(((e,[...n])=>new Uint8Array([e,...n.map((e=>e.charCodeAt(0)))]).buffer)(a.joinGame,s))})),e.addEventListener("close",i),n.setSocket(e);const c=n=>{const a=l(n.data),{header:r}=a;e.removeEventListener("message",c),r===o.errorMsg?(t(!1),d.joinError.innerHTML=a.string,e.removeEventListener("close",i),e.close()):r===o.gameStarting&&(d.codeInput.value="",g(s,e,a.round,a.whoScribbles,1))};e.addEventListener("message",c)}};d.submitJoinCodeButton.onclick=s,d.codeInput.onkeypress=e=>{"Enter"===(e.code||e.key)&&s()},d.finalScribbleOrExpension.onclick=e=>{const n=e.target.checked;d.finalScribble.classList[n?"remove":"add"]("finalDrawingActive"),d.finalExpension.classList[n?"add":"remove"]("finalDrawingActive")}}})()})();